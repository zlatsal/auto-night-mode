<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Night Mode by Sunrise/Sunset</title>
<style>
  body {
    font-family: "Open Sans", sans-serif;
    background-color: #ffffff;
    color: #000000;
    transition: background-color 0.5s ease, color 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    flex-direction: column;
  }

  .night-mode body {
    background-color: #000000;
    color: #ffffff;
  }
</style>
</head>
<body>
  <h1>Auto Night Mode Demo</h1>
  <p>This page changes between day/night mode using your local sunrise and sunset times.</p>
  <button id="theme-toggle">Toggle mode</button>

<script>
async function setNightModeBySunTime() {
  try {
    // Try to get saved theme preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.documentElement.classList.toggle('night-mode', savedTheme === 'night');
      return; // Stop here if user manually chose a theme
    }

    // Get user's location
    const pos = await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 5000 });
    });
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    // Get sunrise/sunset data
    const response = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lng}&formatted=0`);
    const data = await response.json();
    if (data.status !== "OK") throw new Error("Failed to get sun data");

    const sunrise = new Date(data.results.sunrise);
    const sunset = new Date(data.results.sunset);
    const now = new Date();

    // Compare times (API gives UTC, so convert local to UTC)
    const nowUTC = new Date(now.toISOString());
    const isNight = nowUTC < sunrise || nowUTC > sunset;

    // Apply night mode
    document.documentElement.classList.toggle('night-mode', isNight);

  } catch (err) {
    console.warn("Night mode detection failed:", err);
    // fallback simple rule
    const hour = new Date().getHours();
    const isNight = (hour >= 19 || hour < 7);
    document.documentElement.classList.toggle('night-mode', isNight);
  }
}

// Manual toggle + save preference
document.getElementById('theme-toggle').addEventListener('click', function() {
  document.documentElement.classList.toggle('night-mode');
  const isNight = document.documentElement.classList.contains('night-mode');
  localStorage.setItem('theme', isNight ? 'night' : 'day');
});

// Run on load
document.addEventListener('DOMContentLoaded', setNightModeBySunTime);
</script>
</body>
</html>
